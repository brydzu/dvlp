#!/usr/bin/env node

process.env.NODE_NO_WARNINGS = '1';

const { server } = require('../index');
const program = require('commander');
const pkg = require('../package.json');

program
  .usage('[options] <path...>')
  .description(
    'Start a development server, restarting and reloading connected browsers on file changes. \n  Serves static files from one or more <path> directories, or a custom application \n  server if <path> is a single file'
  )
  .option('-p, --port <port>', 'port number', parseInt)
  .option('--no-reload', 'disable reloading connected browsers on file change')
  .arguments('<path...>')
  .action(async (path) => {
    try {
      await server(path.length > 1 ? path : path[0], {
        port: program.port,
        reload: program.reload
      });
    } catch (err) {
      console.error(err);
      process.exit(1);
    }
  })
  .version(pkg.version, '-v, --version')
  .parse(process.argv);
